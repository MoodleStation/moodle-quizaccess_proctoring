var isCameraAllowed=!1;define(["jquery","core/ajax","core/notification"],function(e,t,i){function n(){e(".mod_quiz-next-nav").prop("disabled",!0),e(".submitbtns").html('<p class="text text-red red">You need to enable web camera before submitting this quiz!</p>')}e(function(){e("#id_submitbutton").prop("disabled",!0),e("#id_proctoring").on("change",function(){this.checked&&isCameraAllowed?e("#id_submitbutton").prop("disabled",!1):e("#id_submitbutton").prop("disabled",!0)})});var a=3e3,o=3e4;return{setup:function(d){if(o=d.frequency,a=d.frequency,null!==document.getElementById("page-mod-quiz-summary")&&document.getElementById("page-mod-quiz-summary").innerHTML.length)return!1;if(null!==document.getElementById("page-mod-quiz-review")&&document.getElementById("page-mod-quiz-review").innerHTML.length)return!1;var r=d.image_width,s=0,c=!1,u=null;e("#mod_quiz_navblock").append('<div class="card-body p-3"><h3 class="no text-left">Webcam</h3> <br/><video id="video">Video stream not available.</video><canvas id="canvas" style="display:none;"></canvas><div class="output" style="display:none;"><img id="photo" alt="The picture will appear in this box."/></div></div>');var l=document.getElementById("video"),m=document.getElementById("canvas"),g=document.getElementById("photo"),h=function(){var e=m.getContext("2d");if(r&&s){m.width=r,m.height=s,e.drawImage(l,0,0,r,s),u=m.toDataURL("image/png"),g.setAttribute("src",u),d.webcampicture=u;var n={methodname:"quizaccess_proctoring_send_camshot",args:{courseid:d.courseid,screenshotid:d.id,quizid:d.quizid,webcampicture:u}};t.call([n])[0].done(function(e){e.warnings.length<1||l&&i.addNotification({message:"Something went wrong during taking the image.",type:"error"})}).fail(i.exception)}else!function(){var e=m.getContext("2d");e.fillStyle="#AAA",e.fillRect(0,0,m.width,m.height),u=m.toDataURL("image/png"),g.setAttribute("src",u)}()};return navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(e){l.srcObject=e,l.play(),isCameraAllowed=!0}).catch(function(){n()}),l?(l.addEventListener("canplay",function(){c||(s=l.videoHeight/(l.videoWidth/r),isNaN(s)&&(s=r/(4/3)),l.setAttribute("width",r),l.setAttribute("height",s),m.setAttribute("width",r),m.setAttribute("height",s),c=!0)},!1),l.addEventListener("click",function(e){h(),e.preventDefault()},!1),setTimeout(h,a),setInterval(h,o)):n(),!0},init:function(n){var a=320,o=0,d=!1,r=null,s=null,c=null,u=null;function l(){if(isCameraAllowed){var e=s.getContext("2d");e.fillStyle="#AAA",e.fillRect(0,0,s.width,s.height),u=s.toDataURL("image/png"),c.setAttribute("src",u)}else m()}function m(){e(".mod_quiz-next-nav").prop("disabled",!0),e(".submitbtns").html('<p class="text text-red red">You need to enable web camera before submitting this quiz!</p>')}return r=document.getElementById("video"),s=document.getElementById("canvas"),c=document.getElementById("photo"),r?(navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(e){r.srcObject=e,r.play(),isCameraAllowed=!0}).catch(function(){i.addNotification({message:"Please allow camera access in your browser.",type:"warning"}),m()}),r.addEventListener("canplay",function(){d||(o=r.videoHeight/(r.videoWidth/a),isNaN(o)&&(o=a/(4/3)),r.setAttribute("width",a),r.setAttribute("height",o),s.setAttribute("width",a),s.setAttribute("height",o),d=!0)},!1),r.addEventListener("click",function(e){!function(){var e=s.getContext("2d");if(a&&o){s.width=a,s.height=o,e.drawImage(r,0,0,a,o),u=s.toDataURL("image/png"),c.setAttribute("src",u);var d={courseid:n.courseid,screenshotid:n.id,quizid:n.quizid,webcampicture:u},m={methodname:"quizaccess_proctoring_send_camshot",args:d};t.call([m])[0].done(function(e){e.warnings.length<1||i.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}).fail(i.exception)}else l()}(),e.preventDefault()},!1)):m(),l(),u}}});
//# sourceMappingURL=proctoring.min.js.map
